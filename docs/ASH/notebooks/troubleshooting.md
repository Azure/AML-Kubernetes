# Troubleshooting for Training Using AzureML with Azure Stack Hub Kubernetes Cluster and Storage

## Issues Related to Dataset and Datastore

1. Known limitation:
   Tabular datasets are not supported by datastore in AzureML workspace connected to ASH storage
   
2. If data cannot be uploaded to datastore, check if access token for ASH storage container is valid or not by following 
   [this document](https://github.com/Azure/AML-Kubernetes/blob/master/docs/ASH/Train-AzureArc.md).

## Issues Related to ASH Kubernetes Clusters

1. Attach ASH Kubernetes clusters to AzureML workspace failed
   
   First make sure latest arc extensions are installed and arc connections are created as described in this 
   [here](https://github.com/Azure/AML-Kubernetes/blob/master/docs/ASH/AML-ARC-Compute.md)
   
   You may also run kubectl commands against one of the master nodes of the cluster.
<pre> kubectl get ns </pre>
   You should see "azure-arc" is one of the namespaces.

<pre> kubectl get pods -n azure-arc </pre>
   You should see all the pods are in "running" status
   
2. No progress on AzureML experiment Runs
    For each training run, depending on RunConfiguration, one or multiple pods in default namespace may be scheduled to
   run the training job. Currently, there is a limitation that the number of pods running the training job cannot greater 
   than the number of worker nodes. Therefore, you may need to cancel the none-progressing run, and wait for other runs 
   to finish.
   
   If you do a distributed training run, you may need to reduce the node_count value in Run Configuration.
   
3. If training is successful for one epoch but not for multiple epochs, try to increase memory.

## AzureML Run Issues

These issues are relative easy to debug. You can go to AzureML run logs to check docker image creations, run time errors, 
outputs generated by your scripts etc to pinpoint the problems. Here is a snapshot:

<p align="center">
      <img src="../imgs/azureml_log.png" />
</p>
